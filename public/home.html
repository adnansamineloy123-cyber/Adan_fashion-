<script>
    // ‡ßß. ‡¶™‡ßá‡¶ú ‡¶≤‡ßã‡¶° ‡¶π‡¶ì‡ßü‡¶æ‡¶∞ ‡¶∏‡¶æ‡¶•‡ßá ‡¶∏‡¶æ‡¶•‡ßá ‡¶á‡¶â‡¶ú‡¶æ‡¶∞‡ßá‡¶∞ ‡¶°‡¶æ‡¶ü‡¶æ ‡¶®‡¶ø‡ßü‡ßá ‡¶Ü‡¶∏‡¶æ
    window.onload = async function() {
        const token = localStorage.getItem('user_token');
        if (!token) {
            window.location.href = "index.html"; // ‡¶≤‡¶ó‡¶á‡¶® ‡¶®‡¶æ ‡¶•‡¶æ‡¶ï‡¶≤‡ßá ‡¶´‡ßá‡¶∞‡¶§ ‡¶™‡¶æ‡¶†‡¶æ‡¶®‡ßã
            return;
        }

        // ‡¶ü‡ßã‡¶ï‡ßá‡¶® ‡¶•‡ßá‡¶ï‡ßá ‡¶Ü‡¶á‡¶°‡¶ø ‡¶¨‡ßá‡¶∞ ‡¶ï‡¶∞‡¶æ (Base64 decode)
        const userId = atob(token);

        try {
            // ‡¶∏‡¶æ‡¶∞‡ßç‡¶≠‡¶æ‡¶∞ ‡¶•‡ßá‡¶ï‡ßá ‡¶á‡¶â‡¶ú‡¶æ‡¶∞‡ßá‡¶∞ ‡¶≤‡ßá‡¶ü‡ßá‡¶∏‡ßç‡¶ü ‡¶§‡¶•‡ßç‡¶Ø ‡¶Ü‡¶®‡¶æ
            const response = await fetch(`/auth/user-data?id=${userId}`);
            const data = await response.json();

            if(data.success) {
                // ‡¶°‡¶ø‡¶ú‡¶æ‡¶á‡¶® ‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶® ‡¶®‡¶æ ‡¶ï‡¶∞‡ßá ‡¶∂‡ßÅ‡¶ß‡ßÅ ‡¶ü‡ßá‡¶ï‡ßç‡¶∏‡¶ü ‡¶Ü‡¶™‡¶°‡ßá‡¶ü
                document.querySelector('.profile-box span').innerText = "@" + data.name;
                document.querySelector('.coin-balance').innerText = data.coins + " ü™ô";
            }
        } catch (err) {
            console.log("Error fetching data");
        }
    };

    // ‡ß®. ‡¶®‡ßá‡¶≠‡¶ø‡¶ó‡ßá‡¶∂‡¶® ‡¶´‡¶æ‡¶Ç‡¶∂‡¶® (‡¶Ü‡¶ó‡ßá‡¶∞ ‡¶Æ‡¶§‡ßã‡¶á)
    function navigate(id, el) {
        document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
        document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
        document.getElementById(id).classList.add('active');
        el.classList.add('active');
    }

    // ‡ß©. ‡¶ü‡ßÅ‡¶∞‡ßç‡¶®‡¶æ‡¶Æ‡ßá‡¶®‡ßç‡¶ü‡ßá ‡¶ú‡ßü‡ßá‡¶® ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶®‡¶ø‡¶∞‡¶æ‡¶™‡¶¶ ‡¶´‡¶æ‡¶Ç‡¶∂‡¶®
    async function joinTournament(matchId, entryFee) {
        const token = localStorage.getItem('user_token');
        const userId = atob(token);
        
        // ‡¶ï‡¶®‡¶´‡¶æ‡¶∞‡ßç‡¶Æ‡ßá‡¶∂‡¶® ‡¶™‡ßç‡¶∞‡¶Æ‡ßç‡¶™‡¶ü
        if(!confirm(`Do you want to join for ${entryFee} coins?`)) return;

        try {
            const response = await fetch('/tournament/join', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ userId, entryFee, matchId })
            });

            const result = await response.json();

            if(result.success) {
                // ‡¶ï‡ßü‡ßá‡¶® ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶ï‡¶∞‡¶æ
                document.querySelector('.coin-balance').innerText = result.newBalance + " ü™ô";
                
                // ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶∏‡ßá‡¶á ‡¶ö‡¶Æ‡ßé‡¶ï‡¶æ‡¶∞ ‡¶∏‡ßá‡¶≤‡¶ø‡¶¨‡ßç‡¶∞‡ßá‡¶∂‡¶® ‡¶á‡¶´‡ßá‡¶ï‡ßç‡¶ü
                celebrate(); 
                alert("SUCCESS! MISSION DEPLOYED.");
            } else {
                alert("ERROR: " + result.message);
            }
        } catch (err) {
            alert("SYSTEM ERROR: UNABLE TO JOIN");
        }
    }

    // ‡ß™. ‡¶∏‡ßá‡¶≤‡¶ø‡¶¨‡ßç‡¶∞‡ßá‡¶∂‡¶® (‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶Ö‡¶∞‡¶ø‡¶ú‡¶ø‡¶®‡¶æ‡¶≤ ‡¶ï‡ßã‡¶°)
    function celebrate() {
        confetti({
            particleCount: 150,
            spread: 70,
            origin: { y: 0.6 },
            colors: ['#00f3ff', '#bc13fe', '#ffffff']
        });
    }
              </script>
              
